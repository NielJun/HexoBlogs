---
title: 大话TCP/IP协议栈 一 网络模型
date: 2020-02-29 13:26:43
tags: [tcp/ip协议,网络协议]
category: tcp/ip协议

---

## TCP/IP协议和TCP/IP协议族

​	通常我们说的tcp/ip协议就像大家口中所说的`tcp/ip`协议，也就是`tcp协议`和`ip协议`两个协议。当然狭义上确实是这两个协议，但通常tcp/ip协议指的是利用IP进行通信时所必须用到的`协议群的统称`。具体来说，`IP` 或 `ICMP`、`TCP` 或 `UDP`、`TELNET` 或 `FTP`、以及 `HTTP` 等都属于 `TCP/IP 协议族群`。

### TCP/IP协议

| 协议名称                      | 中文名称     | 协议功能                                                     |
| :---------------------------- | ------------ | ------------------------------------------------------------ |
| Transmission Control Protocol | 传输控制协议 | 一种面向连接的、可靠的、基于字节流的传输层通信协议           |
| Internet Protocol             | 网际协议     | 负责Internet上网络之间的通信，并规定了将数据从一个网络传输到另一个网络应遵循的规则 |



### TCP/IP协议族

| 协议名称                              | 中文名称         | 协议功能                                                     |
| :------------------------------------ | ---------------- | ------------------------------------------------------------ |
| **Transmission Control Protocol**     | 传输控制协议     | 一种面向连接的、可靠的、基于字节流的传输层通信协议           |
| **Internet Protocol**                 | 网际协议         | 负责Internet上网络之间的通信，并规定了将数据从一个网络传输到另一个网络应遵循的规则 |
| **User Datagram Protocol**            | 用户报文协议     | 无连接的传输协议，该协议称为用户数据报协议                   |
| **Internet Control Message Protocol** | 控制报文协议     | 用于在ip主机和路由器之间传递消息                             |
| **Telnet**                            | 远程登陆服务协议 | 为用户提供了在本地计算机上完成远程主机工作的能力             |
| **File Transfer Protocol**            | 文件传输协议     | 用于文件传输的协议                                           |
| **HyperText Transfer Protocol**       | 超文本传输协议   | 是一种用于分布式、协作式和超媒体信息系统的应用层协议         |

​	所以说tcp/ip协议不是简单的两个协议，而是代表着网络通讯的协议族。

## 网络分层模型

​	在网络通讯的时候，由硬件支持到数据传输，必须通过一层一层的数据包装才可以安全有效的进行工作。ISO提出的OSI（Open System Interconnection）模型将网络分为七层，而因特网协议栈共有五层：应用层、传输层、网络层、链路层和物理层。

### **应用层**

​	支持网络应用，应用协议仅仅是网络应用的一个组成部分，运行在不同主机上的进程则使用应用层协议进行通信。主要的协议有：http、ftp、telnet、smtp、pop3等。

### **传输层**

​	负责为信源和信宿提供应用程序进程间的数据传输服务，这一层上主要定义了两个传输协议，传输控制协议即TCP和用户数据报协议UDP。

### **网络层**

​	负责将数据报独立地从信源发送到信宿，主要解决路由选择、拥塞控制和网络互联等问题。

### **数据链路层**

​	负责将IP数据报`封装`成合适在物理网络上传输的`帧`格式并传输，或将从物理网络接收到的帧解封，取出IP数据报交给网络层。

### **物理层**

​	负责将比特流在结点间传输，即负责物理传输。该层的协议既与链路有关也与传输介质有关。

### 模型表格图示

| OSI七层模型 | TCP/IP概念模型 | 功能                                   | TCP/IP协议族                       |
| ----------- | -------------- | -------------------------------------- | ---------------------------------- |
| 应用层      | 应用层         | 文件传输、电子邮件、文件服务、虚拟终端 | TFTP、HTTP、FTP、SMTP、DNS、Telnet |
| 表示层      | 应用层         | 数据格式化、代码转换、数据加密         | 无协议                             |
| 会话层      | 应用层         | 解除或建立和别的连接点的联系           | 无协议                             |
| 传输层      | 传输层         | 提供端对端的接口                       | TCP、UDP                           |
| 网络层      | 网络层         | 为数据包选择路由                       | IP、ICMP、RIP、OSPF、BCP、ICMP     |
| 数据链路层  | 链路层         | 传输有地址的帧以及错误检测功能         | SLIP、CSLIP、PPP、ARP、PARP        |
| 物理层      | 链路层         | 以二进制的形式在物理媒介上传输数据     | ISO2110、IEEE802、IEEE802.2        |

​	事实上ISO旨在指定协议规则，传输过程中每层的功能，而tcp/ip协议面对的是程序传输功能的实现。所以今儿简化了传输过程的分层结构。

## TCP/IP基础

​	互联网进行通信时，需要相应的网络协议，TCP/IP 原本就是为使用互联网而开发制定的协议族。因此，互联网的协议就是 TCP/IP，TCP/IP 就是互联网的协议。

### **数据包**

**包、帧、数据包、段、消息**

以上五个术语都用来表述数据的单位，大致区分如下：

- `包`可以说是全能性术语；
- `帧`用于表示`数据链路层`中`包`的单位；
- 数据包是 `IP` 和 `UDP` 等网络层以上的分层中`包`的单位；
- 段则表示 TCP 数据流中的`信息`；
- 消息是指应用协议中数据的`单位`。

每个分层中，都会对所发送的数据附加一个`首部`，在这个首部中包含了该层必要的信息，如发送的`目标地址`以及协议相关信息。通常，为协议提供的信息为`包首部`，所要发送的内容为`数据`。在下一层的角度看，从上一层收到的包全部都被认为是`本层的数据`。

![数据包](/1.jpg)

​	网络中传输的数据包由两部分组成：一部分是协议所要用到的`首部`，另一部分是上一层传过来的`数据`。首部的结构由协议的具体规范详细定义。在数据包的首部，明确标明了协议应该如何读取数据。反过来说，看到首部，也就能够了解该协议必要的信息以及所要处理的数据。**包首部就像协议的脸**

### **数据处理流程**

​	在数据处理的过程中，以A给B发送邮件为例子：

​	![数据处理流程](/2.jpg)

① 应用程序处理

首先应用程序会进行编码处理，这些编码相当于 OSI 的表示层功能；

编码转化后，邮件不一定马上被发送出去，这种何时建立通信连接何时发送数据的管理功能，相当于 OSI 的会话层功能。

② TCP 模块的处理

TCP 根据应用的指示，负责建立连接、发送数据以及断开连接。TCP 提供将应用层发来的数据顺利发送至对端的可靠传输。为了实现这一功能，需要在应用层数据的前端附加一个 TCP 首部。

③ IP 模块的处理

IP 将 TCP 传过来的 TCP 首部和 TCP 数据合起来当做自己的数据，并在 TCP 首部的前端加上自己的 IP 首部。IP 包生成后，参考路由控制表决定接受此 IP 包的路由或主机。

④ 网络接口（以太网驱动）的处理

从 IP 传过来的 IP 包对于以太网来说就是数据。给这些数据附加上以太网首部并进行发送处理，生成的以太网数据包将通过物理层传输给接收端。

⑤ 网络接口（以太网驱动）的处理

主机收到以太网包后，首先从以太网包首部找到 MAC 地址判断是否为发送给自己的包，若不是则丢弃数据。

如果是发送给自己的包，则从以太网包首部中的类型确定数据类型，再传给相应的模块，如 IP、ARP 等。这里的例子则是 IP 。

⑥ IP 模块的处理

IP 模块接收到 数据后也做类似的处理。从包首部中判断此 IP 地址是否与自己的 IP 地址匹配，如果匹配则根据首部的协议类型将数据发送给对应的模块，如 TCP、UDP。这里的例子则是 TCP。

另外吗，对于有路由器的情况，接收端地址往往不是自己的地址，此时，需要借助路由控制表，在调查应该送往的主机或路由器之后再进行转发数据。

⑦ TCP 模块的处理

在 TCP 模块中，首先会计算一下校验和，判断数据是否被破坏。然后检查是否在按照序号接收数据。检查端口号，确定具体的应用程序。数据被完整地接收以后，会传给由端口号识别的应用程序。

⑧ 应用程序的处理

接收端应用程序会直接接收发送端发送的数据。通过解析数据，展示相应的内容。